<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K.B TECH | CENTRAL INTELLIGENCE PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;400;800&display=swap');
        body { margin: 0; background: #000; color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; overflow: hidden; }
        canvas { position: fixed; top: 0; left: 0; z-index: 1; }
        
        .ui-layer { position: relative; z-index: 10; pointer-events: none; height: 100vh; width: 100vw; display: flex; flex-direction: column; justify-content: space-between; }
        .interactive { pointer-events: auto; }

        .glass-card { 
            background: rgba(255, 255, 255, 0.02); 
            backdrop-filter: blur(25px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            border-radius: 2.5rem; 
            padding: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            transition: 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            position: absolute;
            width: 320px;
        }
        .glass-card:hover { background: rgba(255, 255, 255, 0.05); border-color: rgba(99, 102, 241, 0.5); transform: translateY(-5px); }

        .status-badge { font-size: 8px; font-weight: 900; letter-spacing: 3px; text-transform: uppercase; padding: 4px 12px; border-radius: 99px; }
        .glow-text { text-shadow: 0 0 30px rgba(255,255,255,0.4); }
        .emily-motto { text-shadow: 0 0 50px rgba(99, 102, 241, 0.8); letter-spacing: 0.4em; }
        
        .scanner { position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: linear-gradient(90deg, transparent, #6366f1, transparent); opacity: 0.2; animation: scan 4s linear infinite; z-index: 5; }
        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }

        #audit-log { position: absolute; bottom: 40px; left: 40px; height: 180px; width: 400px; overflow: hidden; font-family: monospace; font-size: 9px; color: rgba(255,255,255,0.4); background: rgba(0,0,0,0.3); padding: 15px; border-radius: 1rem; border-left: 2px solid #6366f1; }
        
        .glitch { animation: glitch 0.3s ease; }
        @keyframes glitch {
            0% { transform: translate(2px, 2px); filter: hue-rotate(90deg); }
            50% { transform: translate(-2px, -2px); filter: hue-rotate(180deg); }
            100% { transform: translate(0); }
        }

        input::placeholder { color: rgba(255,255,255,0.2); }
    </style>
</head>
<body>

    <div class="scanner"></div>

    <div class="ui-layer">
        <header class="p-12 flex justify-between items-start interactive">
            <div class="space-y-1">
                <h1 class="text-6xl font-black italic tracking-tighter glow-text italic">K.B <span class="text-indigo-500">TECH</span></h1>
                <p id="live-clock" class="text-[10px] font-mono text-white/40 uppercase tracking-[0.6em]"></p>
            </div>
            <div class="text-right">
                <div class="flex items-center gap-3 justify-end">
                    <span class="status-badge bg-indigo-500/20 text-indigo-400 border border-indigo-500/30">Gemini 3 Flash Active</span>
                    <span class="status-badge bg-emerald-500/20 text-emerald-500 border border-emerald-500/30">Comandante Kevin</span>
                </div>
                <p class="text-[9px] font-black uppercase tracking-widest mt-3 opacity-40 italic">Central Intelligence B√∫nker v2.0</p>
            </div>
        </header>

        <div id="card-mxn" class="glass-card interactive">
            <p class="text-[10px] font-black uppercase text-indigo-400 tracking-[0.3em] mb-3 italic">Arqueo Global de Fondos</p>
            <p id="val-mxn" class="text-4xl font-black italic tracking-tighter glow-text">$0.00 MXN</p>
            <div class="mt-4 flex justify-between items-center text-[8px] font-bold text-white/20 uppercase italic">
                <span>Revenue 2026</span>
                <span class="text-emerald-400">Secure Vault</span>
            </div>
        </div>

        <div id="card-nodes" class="glass-card interactive">
            <p class="text-[10px] font-black uppercase text-indigo-400 tracking-[0.3em] mb-3 italic">Nodos Sincronizados</p>
            <p id="val-nodes" class="text-4xl font-black italic tracking-tighter glow-text">0</p>
            <div class="mt-4 flex justify-between items-center text-[8px] font-bold text-white/20 uppercase italic">
                <span>Network Status</span>
                <span class="text-emerald-400 animate-pulse">Online</span>
            </div>
        </div>

        <div id="card-pending" class="glass-card interactive">
            <p class="text-[10px] font-black uppercase text-amber-400 tracking-[0.3em] mb-3 italic">Pendientes de Activaci√≥n</p>
            <p id="val-pending" class="text-4xl font-black italic tracking-tighter glow-text">0</p>
            <div class="mt-4 flex justify-between items-center text-[8px] font-bold text-white/20 uppercase italic">
                <span>Autorizaci√≥n Manual</span>
                <span class="text-amber-500">Waiting for Commander</span>
            </div>
        </div>

        <div id="audit-log" class="interactive">
            <div id="log-content" class="space-y-1">
                <p class="text-indigo-400">> INICIANDO PROTOCOLO KB-2026...</p>
                <p>> N√öCLEO GEMINI SINCRONIZADO</p>
            </div>
        </div>

        <div class="w-full flex flex-col items-center pb-12 space-y-10">
            <div class="relative group interactive">
                <div class="absolute -inset-1 bg-gradient-to-r from-indigo-500 to-emerald-500 rounded-full blur opacity-10 group-hover:opacity-40 transition duration-1000"></div>
                <input type="text" id="command-input" class="relative bg-black/80 border border-white/10 rounded-full px-12 py-6 w-[600px] text-sm font-bold focus:outline-none focus:border-indigo-500/50 transition-all uppercase italic tracking-widest text-center shadow-2xl" placeholder="INGRESE COMANDO T√ÅCTICO (SYNC, ACTIVATE, LIST)...">
            </div>
            
            <footer class="text-center space-y-3 interactive">
                <h3 class="text-7xl font-black italic uppercase emily-motto glow-text">Hazlo por Emily</h3>
                <p class="text-[10px] font-black text-white/20 tracking-[1em] uppercase">Ecosistema de Inteligencia M√©dica ‚Ä¢ K.B Tech Solutions</p>
                <div class="pt-4 opacity-20">
                    <p class="text-[8px] font-bold uppercase tracking-[0.8em]">Alpha Build 2.0 ‚Ä¢ Tijuana Hub</p>
                </div>
            </footer>
        </div>
    </div>

    <script>
        const URL_DB = "https://dgatsbnqgplalxwewpvs.supabase.co"; 
        const KEY_DB = "sb_publishable_qXj4L3x_s2sP3-FFQpIOhA_GXP0qX8i"; 

        // --- üåç HOLOGRAMA T√ÅCTICO (THREE.JS) ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const geometry = new THREE.SphereGeometry(4.5, 50, 50);
        const material = new THREE.MeshBasicMaterial({ color: 0x6366f1, wireframe: true, transparent: true, opacity: 0.1 });
        const planet = new THREE.Mesh(geometry, material);
        scene.add(planet);

        camera.position.z = 12;

        function updateUIPos() {
            const nodes = [
                { id: 'card-mxn', x: 7, y: 2, z: 0 },
                { id: 'card-nodes', x: 7, y: -1, z: 0 },
                { id: 'card-pending', x: -7, y: 1, z: 0 }
            ];
            nodes.forEach(n => {
                const vector = new THREE.Vector3(n.x, n.y, n.z);
                vector.project(camera);
                const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
                const y = (vector.y * -0.5 + 0.5) * window.innerHeight;
                const el = document.getElementById(n.id);
                if(el) {
                    el.style.left = `${x - 160}px`;
                    el.style.top = `${y - 60}px`;
                }
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            planet.rotation.y += 0.0015;
            planet.rotation.x += 0.0003;
            updateUIPos();
            renderer.render(scene, camera);
        }
        animate();

        // --- üìä TELEMETR√çA DE INTELIGENCIA ---
        async function syncBunker() {
            try {
                addLog("CONSULTANDO N√öCLEO SUPABASE...");
                
                // Efecto visual
                document.querySelectorAll('.glass-card').forEach(c => c.classList.add('glitch'));

                // 1. Obtener Doctores y filtrar pendientes (Suponiendo columna 'activado')
                const resDoc = await fetch(`${URL_DB}/rest/v1/Perfiles_Medicos`, { headers: { 'apikey': KEY_DB, 'Authorization': `Bearer ${KEY_DB}` } });
                const docs = await resDoc.json();
                
                // Filtramos por activados y pendientes (esto asume que agregaremos la columna 'activado')
                const activos = docs.filter(d => d.activado === true).length;
                const pendientes = docs.filter(d => d.activado !== true).length;

                document.getElementById('val-nodes').innerText = activos;
                document.getElementById('val-pending').innerText = pendientes;

                // 2. Ingresos Globales
                const resCitas = await fetch(`${URL_DB}/rest/v1/Citas?pagado=eq.true`, { headers: { 'apikey': KEY_DB, 'Authorization': `Bearer ${KEY_DB}` } });
                const citas = await resCitas.json();
                const total = citas.reduce((sum, c) => sum + parseFloat(c.monto || 0), 0);
                document.getElementById('val-mxn').innerText = `$${total.toLocaleString()}.00 MXN`;

                addLog(`SYNC OK: ${activos} ACTIVOS | ${pendientes} EN ESPERA`);
                
                setTimeout(() => {
                    document.querySelectorAll('.glass-card').forEach(c => c.classList.remove('glitch'));
                }, 500);

            } catch(e) { addLog("ERR: FALLO DE CONEXI√ìN CON EL HUB TIJUANA"); }
        }

        // --- ‚å®Ô∏è SISTEMA DE COMANDOS MAESTRO ---
        document.getElementById('command-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const fullCmd = this.value.toUpperCase().trim();
                const parts = fullCmd.split(' ');
                const cmd = parts[0];
                const arg = parts[1];
                
                ejecutarComando(cmd, arg);
                this.value = '';
            }
        });

        async function ejecutarComando(cmd, arg) {
            addLog(`EJECUTANDO: ${cmd} ${arg || ''}`);
            
            if (cmd === 'SYNC') syncBunker();
            if (cmd === 'CLEAR') document.getElementById('log-content').innerHTML = '';
            if (cmd === 'REBOOT') window.location.reload();
            
            // COMANDO PARA ACTIVAR UN NODO MANUALMENTE
            if (cmd === 'ACTIVATE' && arg) {
                addLog(`AUTORIZANDO NODO ID: ${arg}...`);
                const res = await fetch(`${URL_DB}/rest/v1/Perfiles_Medicos?id=eq.${arg}`, {
                    method: 'PATCH',
                    headers: { 'apikey': KEY_DB, 'Authorization': `Bearer ${KEY_DB}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ activado: true })
                });
                if(res.ok) {
                    addLog(`EXITO: NODO ${arg} EN LINEA.`);
                    syncBunker();
                } else {
                    addLog(`ERROR: NO SE PUDO ACTIVAR NODO ${arg}.`);
                }
            }

            if (cmd === 'LIST') {
                const res = await fetch(`${URL_DB}/rest/v1/Perfiles_Medicos?activado=is.false`, { headers: { 'apikey': KEY_DB, 'Authorization': `Bearer ${KEY_DB}` } });
                const pend = await res.json();
                pend.forEach(p => addLog(`PENDIENTE: ${p.nombre_doctor} | ID: ${p.id.substring(0,8)}`));
            }
        }

        function addLog(msg) {
            const log = document.getElementById('log-content');
            const p = document.createElement('p');
            p.className = "border-b border-white/5 pb-1";
            p.innerText = `> ${new Date().toLocaleTimeString()} ${msg}`;
            log.prepend(p);
            if(log.children.length > 12) log.lastChild.remove();
        }

        setInterval(syncBunker, 60000); // Sync cada minuto
        syncBunker();

        // Reloj de precisi√≥n
        setInterval(() => {
            const now = new Date();
            document.getElementById('live-clock').innerText = now.toLocaleString('es-MX', {
                hour: '2-digit', minute: '2-digit', second: '2-digit', day: '2-digit', month: '2-digit', year: 'numeric'
            }) + " | SECURE_LINK_ACTIVE";
        }, 1000);

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
