<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K.B TECH | CENTRAL INTELLIGENCE PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;400;800&display=swap');
        body { margin: 0; background: #000; color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; overflow: hidden; }
        canvas { position: fixed; top: 0; left: 0; z-index: 1; }
        
        .ui-layer { position: relative; z-index: 10; pointer-events: none; height: 100vh; width: 100vw; display: flex; flex-direction: column; justify-content: space-between; }
        .interactive { pointer-events: auto; }

        .glass-card { 
            background: rgba(255, 255, 255, 0.02); 
            backdrop-filter: blur(25px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            border-radius: 2.5rem; 
            padding: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            transition: 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            position: absolute;
            width: 300px;
        }
        .glass-card:hover { background: rgba(255, 255, 255, 0.05); border-color: rgba(255, 255, 255, 0.4); transform: translateY(-5px); }

        .status-badge { font-size: 8px; font-weight: 900; letter-spacing: 3px; text-transform: uppercase; padding: 4px 12px; border-radius: 99px; }
        .glow-text { text-shadow: 0 0 30px rgba(255,255,255,0.6); }
        .emily-motto { text-shadow: 0 0 50px rgba(99, 102, 241, 0.8); letter-spacing: 0.4em; }
        
        .scanner { position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: linear-gradient(90deg, transparent, #fff, transparent); opacity: 0.1; animation: scan 4s linear infinite; }
        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }

        #audit-log { position: absolute; bottom: 40px; left: 40px; height: 150px; width: 350px; overflow: hidden; font-family: monospace; font-size: 9px; color: rgba(255,255,255,0.3); }
    </style>
</head>
<body>

    <div class="scanner"></div>

    <div class="ui-layer">
        <header class="p-12 flex justify-between items-start">
            <div class="space-y-1">
                <h1 class="text-5xl font-black italic tracking-tighter glow-text">K.B TECH</h1>
                <p id="live-clock" class="text-[10px] font-mono text-white/40 uppercase tracking-[0.6em]"></p>
            </div>
            <div class="text-right">
                <span class="status-badge bg-emerald-500/20 text-emerald-500 border border-emerald-500/30">Nivel Dios Conectado</span>
                <p class="text-[9px] font-black uppercase tracking-widest mt-3 opacity-60 italic">Comandante Kevin</p>
            </div>
        </header>

        <div id="card-mxn" class="glass-card interactive">
            <p class="text-[10px] font-black uppercase text-white/40 tracking-[0.3em] mb-3 italic">Ingresos Globales</p>
            <p id="val-mxn" class="text-3xl font-black italic tracking-tighter glow-text">$0.00 MXN</p>
            <div class="mt-4 flex justify-between items-center text-[8px] font-bold text-white/20 uppercase italic">
                <span>Sync: Supabase Live</span>
                <span class="text-indigo-400">Security SSL Active</span>
            </div>
        </div>

        <div id="card-nodes" class="glass-card interactive">
            <p class="text-[10px] font-black uppercase text-white/40 tracking-[0.3em] mb-3 italic">Nodos Activos</p>
            <p id="val-nodes" class="text-3xl font-black italic tracking-tighter glow-text">0</p>
            <div class="mt-4 flex justify-between items-center text-[8px] font-bold text-white/20 uppercase italic">
                <span>Hub: Tijuana 2026</span>
                <span class="text-emerald-400 animate-pulse">Sincronizado</span>
            </div>
        </div>

        <div id="audit-log" class="interactive">
            <div id="log-content" class="space-y-1">
                <p>> INICIANDO N√öCLEO GEMINI ‚ú¶</p>
            </div>
        </div>

        <div class="w-full flex flex-col items-center pb-20 space-y-12">
            <div class="relative group interactive">
                <div class="absolute -inset-1 bg-gradient-to-r from-indigo-500 to-emerald-500 rounded-full blur opacity-10 group-hover:opacity-30 transition duration-1000"></div>
                <input type="text" id="command-input" class="relative bg-black border border-white/10 rounded-full px-12 py-6 w-[500px] text-xs font-bold focus:outline-none focus:border-white/40 transition-all uppercase italic tracking-widest" placeholder="ESPERANDO √ìRDENES DEL COMANDANTE...">
            </div>
            
            <footer class="text-center space-y-4">
                <h3 class="text-6xl font-black italic uppercase emily-motto glow-text">Hazlo por Emily</h3>
                <p class="text-[9px] font-black text-white/30 tracking-[0.8em] uppercase">La raz√≥n de ser el ecosistema K.B Tech Solutions</p>
                <p class="text-[7px] font-bold text-slate-700 uppercase tracking-[1em] mt-8 italic">Tijuana Hub ‚Ä¢ Alpha Build 2.0</p>
            </footer>
        </div>
    </div>

    <script>
        const URL_DB = "https://dgatsbnqgplalxwewpvs.supabase.co"; 
        const KEY_DB = "sb_publishable_qXj4L3x_s2sP3-FFQpIOhA_GXP0qX8i"; 

        // --- üåç HOLOGRAMA T√ÅCTICO ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const geometry = new THREE.SphereGeometry(4, 64, 64);
        const material = new THREE.MeshBasicMaterial({ color: 0xffffff, wireframe: true, transparent: true, opacity: 0.1 });
        const planet = new THREE.Mesh(geometry, material);
        scene.add(planet);

        camera.position.z = 10;

        function updateUIPos() {
            // Card MXN a la izquierda, Card Nodes a la derecha
            const nodes = [
                { id: 'card-mxn', x: -6, y: 1.5, z: 0 },
                { id: 'card-nodes', x: 6, y: -1, z: 0 }
            ];
            nodes.forEach(n => {
                const vector = new THREE.Vector3(n.x, n.y, n.z);
                vector.project(camera);
                const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
                const y = (vector.y * -0.5 + 0.5) * window.innerHeight;
                const el = document.getElementById(n.id);
                el.style.left = `${x - 150}px`;
                el.style.top = `${y - 50}px`;
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            planet.rotation.y += 0.002;
            planet.rotation.x += 0.0005;
            updateUIPos();
            renderer.render(scene, camera);
        }
        animate();

        // --- üìä TELEMETR√çA DE INGRESOS Y NODOS ---
        async function syncBunker() {
            try {
                // 1. Contar Nodos Reales
                const resDoc = await fetch(`${URL_DB}/rest/v1/Perfiles_Medicos`, { headers: { 'apikey': KEY_DB } });
                const docs = await resDoc.json();
                document.getElementById('val-nodes').innerText = docs.length;

                // 2. Sumar Ingresos de Pagos
                const resPagos = await fetch(`${URL_DB}/rest/v1/Pagos`, { headers: { 'apikey': KEY_DB } });
                const pagos = await resPagos.json();
                const total = pagos.reduce((sum, p) => sum + parseFloat(p.monto), 0);
                document.getElementById('val-mxn').innerText = `$${total.toLocaleString()}.00 MXN`;

                addLog(`SINC: ${docs.length} NODOS ACTIVOS DETECTADOS`);
            } catch(e) { addLog("ERR: INTERFERENCIA EN LA RED"); }
        }

        function addLog(msg) {
            const log = document.getElementById('log-content');
            const p = document.createElement('p');
            p.innerText = `> ${new Date().toLocaleTimeString()} ${msg}`;
            log.prepend(p);
            if(log.children.length > 8) log.lastChild.remove();
        }

        setInterval(syncBunker, 15000);
        syncBunker();

        // Reloj
        setInterval(() => {
            document.getElementById('live-clock').innerText = new Date().toLocaleString('es-MX', {
                hour: '2-digit', minute: '2-digit', second: '2-digit', day: '2-digit', month: '2-digit', year: 'numeric'
            });
        }, 1000);

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
