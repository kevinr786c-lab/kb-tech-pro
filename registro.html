<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K.B Tech Pro | Activaci√≥n de Nodo M√©dico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;500;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #0f172a; color: white; transition: 0.5s; }
        .preview-phone { width: 260px; height: 500px; border: 12px solid #1e293b; border-radius: 3rem; position: relative; overflow: hidden; background: #f8fafc; transition: 0.5s; box-shadow: 0 50px 100px -20px rgba(0,0,0,0.5); }
        .color-dot { width: 35px; height: 35px; border-radius: 50%; cursor: pointer; transition: 0.3s; border: 3px solid transparent; }
        .color-dot.active { border-color: white; transform: scale(1.2); box-shadow: 0 0 20px rgba(99,102,241,0.5); }
        .glass-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1); }
        #prev-bg-icon { transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body class="p-4 md:p-8 flex items-center justify-center min-h-screen">

    <div class="max-w-6xl w-full grid grid-cols-1 lg:grid-cols-12 gap-12 items-center">
        <div class="lg:col-span-7 space-y-8">
            <header>
                <h1 class="text-5xl font-black italic tracking-tighter mb-2 italic">K.B <span class="text-indigo-400 text-main-dynamic">TECH</span></h1>
                <p class="text-slate-400 text-xs uppercase tracking-[0.4em] font-bold italic uppercase">Plataforma de Gesti√≥n M√©dica de √âlite</p>
            </header>

            <form id="form-registro" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-[10px] font-black uppercase text-slate-500 ml-4 italic">Nombre del Especialista</label>
                        <input type="text" id="nombre" placeholder="Ej. Dr. Kevin Rivera" class="w-full bg-slate-800/50 p-4 rounded-2xl border border-slate-700 outline-none focus:border-white transition-all text-sm font-bold text-white">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] font-black uppercase text-slate-500 ml-4 italic">Especialidad</label>
                        <select id="especialidad" onchange="cambiarCatalogo()" class="w-full bg-slate-800/50 p-4 rounded-2xl border border-slate-700 outline-none focus:border-white text-sm font-bold text-white appearance-none">
                            <option value="Ginecolog√≠a">Ginecolog√≠a</option>
                            <option value="Odontolog√≠a">Odontolog√≠a</option>
                            <option value="Pediatr√≠a">Pediatr√≠a</option>
                            <option value="Cardiolog√≠a">Cardiolog√≠a</option>
                            <option value="Bienestar (Nutri/Psico)">Bienestar (Nutri/Psico)</option>
                            <option value="General">Medicina General</option>
                        </select>
                    </div>
                </div>

                <div class="glass-card p-8 rounded-[3rem] space-y-6">
                    <div class="flex justify-between items-center">
                        <p class="text-[10px] font-black uppercase text-indigo-400 tracking-[0.3em] italic">Atm√≥sfera Visual</p>
                        <span id="theme-tag" class="text-[9px] font-black bg-white/10 px-3 py-1 rounded-full uppercase italic text-white">Seleccione</span>
                    </div>
                    <div id="contenedor-colores" class="flex gap-6 flex-wrap"></div>
                </div>

                <div class="flex items-center gap-6 p-6 bg-indigo-500/5 rounded-[2.5rem] border border-white/5">
                    <div class="flex-grow">
                        <p class="text-[9px] font-black uppercase text-indigo-400 mb-1 italic">Activaci√≥n Nodo Pro</p>
                        <p class="text-4xl font-black text-white">$1,599 <span class="text-xs text-slate-500 italic font-normal">MXN/mes</span></p>
                    </div>
                    <button type="button" onclick="procesarPago(event)" class="px-10 py-5 bg-indigo-500 text-white rounded-[2rem] font-black uppercase text-[10px] tracking-[0.2em] shadow-lg hover:scale-105 transition-all">Activar Nodo</button>
                </div>
            </form>
        </div>

        <div class="lg:col-span-5 flex flex-col items-center justify-center space-y-8">
            <div class="text-center px-4">
                <p class="text-[10px] font-black uppercase text-slate-500 tracking-widest mb-2 italic">Prevista de Nodo</p>
                <p id="prev-privacidad" class="text-[9px] text-indigo-200 italic leading-tight max-w-[250px] mx-auto"></p>
            </div>
            <div id="preview-box" class="preview-phone">
                <div id="prev-bg-icon" class="absolute top-10 right-[-40px] text-[15rem] opacity-5 text-slate-900 pointer-events-none select-none">üè•</div>
                <div class="p-8 text-slate-800 space-y-8 relative h-full flex flex-col justify-center bg-white/90 text-center">
                    <div id="prev-icon" class="text-6xl mb-2">üè•</div>
                    <div class="h-4 w-32 bg-slate-200 rounded-full mx-auto mb-2"></div>
                    <div id="prev-button" class="h-14 w-full rounded-[1.5rem] shadow-xl transition-all"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const URL_DB = "https://dgatsbnqgplalxwewpvs.supabase.co"; 
        const KEY_DB = "sb_publishable_qXj4L3x_s2sP3-FFQpIOhA_GXP0qX8i"; 

        const CATALOGO = {
            "Ginecolog√≠a": [
                { id: 2, color: "#f43f5e", icon: "üå∏", bg: "üå∏", desc: "Rose Quartz", tag: "Floral", priv: "Privacidad: Sus datos de salud femenina son tratados con m√°xima reserva legal." },
                { id: 5, color: "#8b5cf6", icon: "üîÆ", bg: "‚ú®", desc: "Lavender Silk", tag: "Boutique", priv: "Privacidad: Resguardamos su informaci√≥n con elegancia y total discreci√≥n." }
            ],
            "Odontolog√≠a": [
                { id: 1, color: "#0ea5e9", icon: "üíé", bg: "ü¶∑", tag: "Arctic", priv: "Privacidad: Registros dentales protegidos bajo protocolos de seguridad digital avanzada." },
                { id: 3, color: "#10b981", icon: "üåø", bg: "üçÉ", tag: "Emerald", priv: "Privacidad: Historial bucal resguardado en entorno digital de bienestar." }
            ],
            "Pediatr√≠a": [
                { id: 2, color: "#fb923c", icon: "üß∏", bg: "üéà", tag: "Sunny", priv: "Privacidad: La informaci√≥n de los menores es sagrada. M√°xima protecci√≥n pedi√°trica." }
            ],
            "General": [
                { id: 4, color: "#1e3a8a", icon: "‚öñÔ∏è", bg: "üõ°Ô∏è", tag: "S√≥lido", priv: "Privacidad: Sus datos y notas de consulta son encriptados bajo la ley vigente." },
                { id: 1, color: "#6366f1", icon: "üè•", bg: "üß¨", tag: "Moderno", priv: "Privacidad: Seguridad digital de vanguardia para su historial cl√≠nico." }
            ]
        };

        let currentSelection = { template_id: 1, color: "#6366f1", privacidad: "" };

        function cambiarCatalogo() {
            const esp = document.getElementById('especialidad').value;
            const contenedor = document.getElementById('contenedor-colores');
            const temas = CATALOGO[esp] || CATALOGO["General"];
            contenedor.innerHTML = "";
            temas.forEach((t, index) => {
                const dot = document.createElement('div');
                dot.className = `color-dot ${index === 0 ? 'active' : ''}`;
                dot.style.backgroundColor = t.color;
                dot.onclick = () => {
                    document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
                    dot.classList.add('active');
                    currentSelection = { template_id: t.id, color: t.color, privacidad: t.priv };
                    document.getElementById('prev-button').style.backgroundColor = t.color;
                    document.getElementById('prev-icon').innerText = t.icon;
                    document.getElementById('prev-bg-icon').innerText = t.bg;
                    document.getElementById('prev-privacidad').innerText = t.priv;
                    document.getElementById('theme-tag').innerText = t.tag;
                    document.getElementById('theme-tag').style.color = t.color;
                };
                contenedor.appendChild(dot);
                if(index === 0) dot.click();
            });
        }

        async function procesarPago(event) {
            const nombre = document.getElementById('nombre').value;
            if(!nombre) return alert("Nombre obligatorio");
            
            const btn = event.target;
            btn.innerText = "ACTIVANDO...";
            btn.disabled = true;

            try {
                const res = await fetch(`${URL_DB}/rest/v1/Perfiles_Medicos`, {
                    method: 'POST',
                    headers: { 'apikey': KEY_DB, 'Authorization': `Bearer ${KEY_DB}`, 'Content-Type': 'application/json', 'Prefer': 'return=representation' },
                    body: JSON.stringify({
                        nombre_doctor: nombre,
                        especialidad: document.getElementById('especialidad').value,
                        template_id: currentSelection.template_id,
                        plan: 'Dominio',
                        email: nombre.toLowerCase().replace(/ /g, ".") + "@kbtech.com",
                        frase_personalizada: currentSelection.privacidad
                    })
                });

                if(res.ok) {
                    const data = await res.json();
                    alert("¬°NODO ACTIVADO!");
                    // SALTO DIRECTO A APP.HTML CON LA ID
                    window.location.href = `app.html?id=${data[0].id}`;
                } else {
                    throw new Error("Error 400");
                }
            } catch(e) {
                alert("Error: Revisa que el nombre no est√© repetido.");
                btn.innerText = "Activar Nodo";
                btn.disabled = false;
            }
        }
        cambiarCatalogo();
    </script>
</body>
</html>
