<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K.B Tech Pro | Activaci√≥n de Nodo M√©dico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;500;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #0f172a; color: white; transition: 0.5s; }
        .preview-phone { width: 260px; height: 500px; border: 12px solid #1e293b; border-radius: 3rem; position: relative; overflow: hidden; background: #f8fafc; transition: 0.5s; box-shadow: 0 50px 100px -20px rgba(0,0,0,0.5); }
        .color-dot { width: 35px; height: 35px; border-radius: 50%; cursor: pointer; transition: 0.3s; border: 3px solid transparent; }
        .color-dot.active { border-color: white; transform: scale(1.2); box-shadow: 0 0 20px rgba(99,102,241,0.5); }
        .glass-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1); }
        #prev-bg-icon { transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body class="p-4 md:p-8 flex items-center justify-center min-h-screen">

    <div class="max-w-6xl w-full grid grid-cols-1 lg:grid-cols-12 gap-12 items-center">
        <div class="lg:col-span-7 space-y-8">
            <header>
                <h1 class="text-5xl font-black italic tracking-tighter mb-2 italic">K.B <span id="text-logo" class="text-indigo-400">TECH</span></h1>
                <p class="text-slate-400 text-xs uppercase tracking-[0.4em] font-bold">Gesti√≥n M√©dica de √âlite</p>
            </header>

            <form id="form-registro" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-[10px] font-black uppercase text-slate-500 ml-4 italic">Nombre del Especialista</label>
                        <input type="text" id="nombre" placeholder="Ej. Dr. Kevin Rivera" class="w-full bg-slate-800/50 p-4 rounded-2xl border border-slate-700 outline-none focus:border-white transition-all text-sm font-bold text-white">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] font-black uppercase text-slate-500 ml-4 italic">Especialidad</label>
                        <select id="especialidad" onchange="cambiarCatalogo()" class="w-full bg-slate-800/50 p-4 rounded-2xl border border-slate-700 outline-none text-sm font-bold text-white appearance-none">
                            <option value="Ginecolog√≠a">Ginecolog√≠a</option>
                            <option value="Odontolog√≠a">Odontolog√≠a</option>
                            <option value="Pediatr√≠a">Pediatr√≠a</option>
                            <option value="Cardiolog√≠a">Cardiolog√≠a</option>
                            <option value="Bienestar">Bienestar</option>
                            <option value="General">Medicina General</option>
                        </select>
                    </div>
                </div>

                <div class="glass-card p-8 rounded-[3rem] space-y-6">
                    <div class="flex justify-between items-center">
                        <p class="text-[10px] font-black uppercase text-indigo-400 tracking-[0.3em] italic">Ambiente Atmosf√©rico</p>
                        <span id="theme-tag" class="text-[9px] font-black bg-white/10 px-3 py-1 rounded-full uppercase italic text-white">Seleccione</span>
                    </div>
                    <div id="contenedor-colores" class="flex gap-6 flex-wrap"></div>
                </div>

                <div class="flex items-center gap-6 p-6 bg-indigo-500/5 rounded-[2.5rem] border border-white/5">
                    <div class="flex-grow">
                        <p class="text-[9px] font-black uppercase text-indigo-400 mb-1 italic">Activaci√≥n de Nodo Pro</p>
                        <p class="text-4xl font-black text-white">$1,599 <span class="text-xs text-slate-500 italic font-normal">MXN/mes</span></p>
                    </div>
                    <button type="button" onclick="procesarPago(event)" class="px-10 py-5 bg-indigo-500 text-white rounded-[2rem] font-black uppercase text-[10px] tracking-[0.2em] shadow-lg hover:bg-indigo-400 transition-all">Activar</button>
                </div>
            </form>
        </div>

        <div class="lg:col-span-5 flex flex-col items-center">
            <div id="preview-box" class="preview-phone">
                <div id="prev-bg-icon" class="absolute top-10 right-[-40px] text-[15rem] opacity-5 text-slate-900 pointer-events-none select-none">üè•</div>
                <div class="p-8 text-slate-800 space-y-8 relative h-full flex flex-col justify-center bg-white/90 text-center">
                    <div id="prev-icon" class="text-5xl mb-4">üè•</div>
                    <div class="h-5 w-40 bg-slate-200 rounded-full mx-auto"></div>
                    <div id="prev-button" class="h-14 w-full rounded-[1.5rem] shadow-xl transition-all"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const URL_DB = "https://dgatsbnqgplalxwewpvs.supabase.co"; 
        const KEY_DB = "sb_publishable_qXj4L3x_s2sP3-FFQpIOhA_GXP0qX8i"; 

        const CATALOGO = {
            "Ginecolog√≠a": [{ id: 2, color: "#f43f5e", icon: "üå∏", tag: "Floral" }, { id: 5, color: "#8b5cf6", icon: "üîÆ", tag: "Boutique" }],
            "Odontolog√≠a": [{ id: 1, color: "#0ea5e9", icon: "üíé", tag: "Arctic" }, { id: 3, color: "#10b981", icon: "üåø", tag: "Emerald" }],
            "Pediatr√≠a": [{ id: 2, color: "#fb923c", icon: "üß∏", tag: "Infantil" }, { id: 1, color: "#38bdf8", icon: "üöÄ", tag: "L√∫dico" }],
            "General": [{ id: 4, color: "#1e3a8a", icon: "‚öñÔ∏è", tag: "S√≥lido" }, { id: 1, color: "#6366f1", icon: "üè•", tag: "Moderno" }]
        };

        let currentSelection = { template_id: 1, color: "#6366f1" };

        function cambiarCatalogo() {
            const esp = document.getElementById('especialidad').value;
            const contenedor = document.getElementById('contenedor-colores');
            const temas = CATALOGO[esp] || CATALOGO["General"];
            contenedor.innerHTML = "";
            temas.forEach((t, index) => {
                const dot = document.createElement('div');
                dot.className = `color-dot ${index === 0 ? 'active' : ''}`;
                dot.style.backgroundColor = t.color;
                dot.onclick = () => {
                    document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
                    dot.classList.add('active');
                    currentSelection = { template_id: t.id, color: t.color };
                    document.getElementById('prev-button').style.backgroundColor = t.color;
                    document.getElementById('prev-icon').innerText = t.icon;
                    document.getElementById('theme-tag').innerText = t.tag;
                    document.getElementById('text-logo').style.color = t.color;
                    document.getElementById('prev-bg-icon').innerText = t.icon;
                };
                contenedor.appendChild(dot);
                if(index === 0) dot.click();
            });
        }

        async function procesarPago(event) {
            const nombre = document.getElementById('nombre').value;
            if(!nombre) return alert("Nombre obligatorio");
            
            const btn = event.target;
            btn.innerText = "ACTIVANDO...";
            btn.disabled = true;

            const res = await fetch(`${URL_DB}/rest/v1/Perfiles_Medicos`, {
                method: 'POST',
                headers: { 
                    'apikey': KEY_DB, 
                    'Authorization': `Bearer ${KEY_DB}`, 
                    'Content-Type': 'application/json', 
                    'Prefer': 'return=representation' 
                },
                body: JSON.stringify({
                    nombre_doctor: nombre,
                    especialidad: document.getElementById('especialidad').value,
                    template_id: currentSelection.template_id,
                    plan: 'Dominio',
                    email: nombre.toLowerCase().replace(/ /g, ".") + "@kbtech.com"
                })
            });

            if(res.ok) {
                const data = await res.json();
                alert("¬°NODO ACTIVADO!");
                // MODIFICACI√ìN: Ahora te manda al panel del doctor (app.html)
                window.location.href = `app.html?id=${data[0].id}`;
            } else {
                alert("Error de registro.");
                btn.innerText = "Activar";
                btn.disabled = false;
            }
        }
        cambiarCatalogo();
    </script>
</body>
</html>
