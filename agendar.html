que le parece <!DOCTYPE html>
<html lang="es">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>K.B SYSTEM | AGENDADOR ELITE âœ¦</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <style>
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;600;800&display=swap');
Â  Â  Â  Â  :root { --main: #c5a059; --dark: #0f172a; }
Â  Â  Â  Â  body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f8fafc; color: var(--dark); }
Â  Â  Â  Â  .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); border: 1px solid rgba(197, 160, 89, 0.2); border-radius: 2.5rem; }
Â  Â  Â  Â  .input-elite { width: 100%; padding: 1rem; border-radius: 1.2rem; border: 1px solid #e2e8f0; outline: none; transition: 0.3s; font-weight: 600; }
Â  Â  Â  Â  .input-elite:focus { border-color: var(--main); box-shadow: 0 0 0 4px rgba(197, 160, 89, 0.1); }
Â  Â  Â  Â  .time-pill { padding: 0.8rem; border-radius: 1rem; border: 1px solid #e2e8f0; text-align: center; cursor: pointer; font-weight: 800; font-size: 0.8rem; transition: 0.3s; background: white; }
Â  Â  Â  Â  .time-pill.selected { background: var(--main); color: white; border-color: var(--main); transform: scale(1.05); }
Â  Â  Â  Â  .btn-mision { width: 100%; padding: 1.2rem; border-radius: 1.5rem; background: var(--dark); color: white; font-weight: 800; text-transform: uppercase; letter-spacing: 0.1em; transition: 0.4s; }
Â  Â  Â  Â  .btn-mision:hover { background: var(--main); transform: translateY(-3px); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* ESTILOS DE ESTATUS */
Â  Â  Â  Â  .badge-estatus { display: none; padding: 0.3rem 0.8rem; border-radius: 0.7rem; font-size: 0.65rem; font-weight: 900; text-transform: uppercase; letter-spacing: 0.05em; transition: 0.3s; }
Â  Â  Â  Â  .estatus-nuevo { background: #fff7ed; color: #c2410c; border: 1px solid #ffedd5; }
Â  Â  Â  Â  .estatus-recurrente { background: #f0fdf4; color: #15803d; border: 1px solid #dcfce7; }
Â  Â  Â  Â  .estatus-oro { background: #fefce8; color: #a16207; border: 1px solid #fef08a; box-shadow: 0 4px 10px rgba(197, 160, 89, 0.2); }
Â  Â  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

Â  Â  <div class="max-w-md w-full glass p-8 shadow-2xl">
Â  Â  Â  Â  <header class="text-center mb-8">
Â  Â  Â  Â  Â  Â  <h1 id="doc-name" class="text-xl font-black italic uppercase tracking-tighter text-slate-900">Cargando BÃºnker...</h1>
Â  Â  Â  Â  Â  Â  <p class="text-[9px] font-bold text-slate-400 uppercase tracking-widest mt-1">Terminal de Inteligencia MÃ©dica</p>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <form id="agendador-form" class="space-y-5">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center mb-2 px-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-[10px] font-black uppercase text-slate-400 italic">IdentificaciÃ³n (TelÃ©fono)</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="badge-paciente" class="badge-estatus italic"></span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="tel" id="telefono" placeholder="10 DÃGITOS" class="input-elite" maxlength="10" required>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="nombre" placeholder="NOMBRE COMPLETO" class="input-elite uppercase" required>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" id="email" placeholder="EMAIL" class="input-elite text-xs">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="fecha_nacimiento" class="input-elite text-xs">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <select id="servicio" class="input-elite text-xs uppercase font-bold" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="" disabled selected>Seleccione Servicio</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="fecha" class="input-elite">
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="radar-horas" class="grid grid-cols-3 gap-2 py-2"></div>

Â  Â  Â  Â  Â  Â  <input type="hidden" id="hora_seleccionada">
Â  Â  Â  Â  Â  Â  <button type="submit" id="confirmar-btn" class="btn-mision">Confirmar ReservaciÃ³n âœ¦</button>
Â  Â  Â  Â  </form>
Â  Â  </div>

<script type="module">
Â  Â  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
Â  Â  const supabase = createClient('https://ctvqjnckxmqeejbfwmkj.supabase.co', 'sb_publishable__JScNe1oUvVbV4Vww69CLg_6EasQg3w');
Â  Â  const docId = '196c57b5-68d5-4825-8607-36b5d3bc3e15';

Â  Â  // ğŸ§  LÃ“GICA DE INTELIGENCIA: Reconocimiento y ClasificaciÃ³n
Â  Â  document.getElementById('telefono').addEventListener('input', async (e) => {
Â  Â  Â  Â  const tel = e.target.value;
Â  Â  Â  Â  const badge = document.getElementById('badge-paciente');

Â  Â  Â  Â  if (tel.length === 10) {
Â  Â  Â  Â  Â  Â  const { data: pac } = await supabase.from('Pacientes').select('*').eq('telefono', tel).maybeSingle();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (pac) {
Â  Â  Â  Â  Â  Â  Â  Â  // Autocompletar datos
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nombre').value = pac.nombre;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('email').value = pac.email || '';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('fecha_nacimiento').value = pac.fecha_nacimiento || '';

Â  Â  Â  Â  Â  Â  Â  Â  // Escaneo de historial para asignar Rango
Â  Â  Â  Â  Â  Â  Â  Â  const { count } = await supabase.from('Citas').select('*', { count: 'exact', head: true }).eq('paciente_id', pac.id);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  badge.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  if (count >= 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  badge.innerText = "âœ¦ PACIENTE ORO";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  badge.className = "badge-estatus estatus-oro italic";
Â  Â  Â  Â  Â  Â  Â  Â  } else if (count >= 1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  badge.innerText = "âœ“ RECURRENTE";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  badge.className = "badge-estatus estatus-recurrente italic";
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Es un paciente nuevo
Â  Â  Â  Â  Â  Â  Â  Â  badge.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  badge.innerText = "+ PACIENTE NUEVO";
Â  Â  Â  Â  Â  Â  Â  Â  badge.className = "badge-estatus estatus-nuevo italic";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  badge.style.display = 'none';
Â  Â  Â  Â  }
Â  Â  });

Â  Â  // ğŸ›¡ï¸ RADAR DE DISPONIBILIDAD
Â  Â  async function actualizarRadar() {
Â  Â  Â  Â  const fecha = document.getElementById('fecha').value;
Â  Â  Â  Â  const servId = document.getElementById('servicio').value;
Â  Â  Â  Â  const radar = document.getElementById('radar-horas');
Â  Â  Â  Â  if (!fecha || !servId) return;

Â  Â  Â  Â  radar.innerHTML = '<p class="col-span-3 text-center text-[8px] font-black animate-pulse">Analizando Radar...</p>';
Â  Â  Â  Â  const serv = document.getElementById('servicio').selectedOptions[0];
Â  Â  Â  Â  const { data: slots } = await supabase.rpc('obtener_horarios_disponibles', {
Â  Â  Â  Â  Â  Â  p_doctor: docId, p_fecha: fecha, p_duracion: parseInt(serv.dataset.total)
Â  Â  Â  Â  });

Â  Â  Â  Â  radar.innerHTML = slots?.length ? '' : '<p class="col-span-3 text-center text-[8px] font-black text-rose-500">BÃšNKER TOTALMENTE OCUPADO</p>';
Â  Â  Â  Â  slots?.forEach(s => {
Â  Â  Â  Â  Â  Â  const pill = document.createElement('div');
Â  Â  Â  Â  Â  Â  pill.className = 'time-pill';
Â  Â  Â  Â  Â  Â  pill.innerText = s.hora.slice(0,5);
Â  Â  Â  Â  Â  Â  pill.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.time-pill').forEach(p => p.classList.remove('selected'));
Â  Â  Â  Â  Â  Â  Â  Â  pill.classList.add('selected');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('hora_seleccionada').value = s.hora;
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  radar.appendChild(pill);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  document.getElementById('fecha').onchange = actualizarRadar;
Â  Â  document.getElementById('servicio').onchange = actualizarRadar;

Â  Â  // INICIALIZACIÃ“N
Â  Â  async function init() {
Â  Â  Â  Â  const { data: doc } = await supabase.from('Usuarios').select('nombre').eq('id', docId).single();
Â  Â  Â  Â  document.getElementById('doc-name').innerText = `DR. ${doc.nombre}`;

Â  Â  Â  Â  const { data: servs } = await supabase.from('Servicios').select('*').eq('doctor_id', docId).eq('activo', true);
Â  Â  Â  Â  const select = document.getElementById('servicio');
Â  Â  Â  Â  servs?.forEach(s => {
Â  Â  Â  Â  Â  Â  const opt = document.createElement('option');
Â  Â  Â  Â  Â  Â  opt.value = s.id;
Â  Â  Â  Â  Â  Â  opt.dataset.total = s.duracion_total;
Â  Â  Â  Â  Â  Â  opt.dataset.monto = s.precio;
Â  Â  Â  Â  Â  Â  opt.innerText = `${s.nombre.toUpperCase()} â€” $${s.precio}`;
Â  Â  Â  Â  Â  Â  select.appendChild(opt);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  document.getElementById('agendador-form').onsubmit = async (e) => {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  const btn = document.getElementById('confirmar-btn');
Â  Â  Â  Â  const tel = document.getElementById('telefono').value;
Â  Â  Â  Â  const hora = document.getElementById('hora_seleccionada').value;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(!hora) return alert("Seleccione una hora en el radar.");
Â  Â  Â  Â Â 
Â  Â  Â  Â  btn.disabled = true; btn.innerText = "Sincronizando con BÃºnker...";

Â  Â  Â  Â  let { data: pac } = await supabase.from('Pacientes').select('id').eq('telefono', tel).maybeSingle();
Â  Â  Â  Â  if (!pac) {
Â  Â  Â  Â  Â  Â  const { data } = await supabase.from('Pacientes').insert({Â 
Â  Â  Â  Â  Â  Â  Â  Â  nombre: document.getElementById('nombre').value.toUpperCase(),Â 
Â  Â  Â  Â  Â  Â  Â  Â  telefono: tel,Â 
Â  Â  Â  Â  Â  Â  Â  Â  email: document.getElementById('email').value,
Â  Â  Â  Â  Â  Â  Â  Â  fecha_nacimiento: document.getElementById('fecha_nacimiento').value
Â  Â  Â  Â  Â  Â  }).select().single();
Â  Â  Â  Â  Â  Â  pac = data;
Â  Â  Â  Â  }

Â  Â  Â  Â  const serv = document.getElementById('servicio').selectedOptions[0];
Â  Â  Â  Â  const { error } = await supabase.from('Citas').insert({
Â  Â  Â  Â  Â  Â  doctor_id: docId, paciente_id: pac.id, servicio_id: serv.value,
Â  Â  Â  Â  Â  Â  fecha: document.getElementById('fecha').value, hora_inicio: hora,
Â  Â  Â  Â  Â  Â  duracion_cita: parseInt(serv.dataset.total), monto: parseFloat(serv.dataset.monto), estado: 'pendiente'
Â  Â  Â  Â  });

Â  Â  Â  Â  if (error) { alert("Error: " + error.message); btn.disabled = false; btn.innerText = "Reintentar"; }
Â  Â  Â  Â  else { alert("âœ… MISIÃ“N CONFIRMADA."); location.reload(); }
Â  Â  };

Â  Â  init();
</script>
</body>
</html>
