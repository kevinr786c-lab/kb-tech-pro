<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K.B Tech Pro | Reservar Cita</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;500;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; transition: 0.8s; overflow-x: hidden; background-color: #f8fafc; }
        :root { --main: #6366f1; }
        
        .bg-element { position: fixed; z-index: -1; opacity: 0.1; pointer-events: none; transition: 1s; filter: blur(2px); }
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.5); box-shadow: 0 50px 100px -20px rgba(0,0,0,0.1); }
        
        /* Estilo para Inputs Modernos (Phone Style) */
        .input-modern { 
            width: 100%; 
            padding: 1.25rem; 
            border-radius: 1.5rem; 
            background: #f1f5f9; 
            border: 2px solid transparent; 
            font-weight: 700; 
            font-size: 0.9rem; 
            transition: 0.3s; 
            outline: none;
        }
        .input-modern:focus { border-color: var(--main); background: white; box-shadow: 0 10px 25px -10px var(--main); }

        /* Estilizaci√≥n de selectores nativos */
        input[type="date"], input[type="time"] { cursor: pointer; color: #1e293b; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="visual-1" class="bg-element top-[-5%] right-[-5%] text-[25rem]"></div>
    <div id="visual-2" class="bg-element bottom-[-5%] left-[-5%] text-[20rem]"></div>

    <div class="max-w-md w-full glass-card p-10 rounded-[3.5rem] relative z-10 border-t-[10px]" id="card-main">
        <header class="text-center mb-10">
            <div id="icon-header" class="text-7xl mb-4 drop-shadow-xl animate-bounce" style="animation-duration: 4s;">üè•</div>
            <h1 id="doc-name" class="text-3xl font-black tracking-tighter text-slate-800 uppercase italic">Cargando...</h1>
            <p id="doc-esp" class="text-[9px] font-black text-slate-400 uppercase tracking-[0.4em] italic mt-2"></p>
        </header>

        <form id="form-cita" class="space-y-6">
            <div class="space-y-1">
                <label class="text-[10px] font-black uppercase text-slate-400 ml-4 italic">Paciente</label>
                <input type="text" id="nombre" placeholder="Nombre completo" class="input-modern" required>
            </div>

            <div class="space-y-1">
                <label class="text-[10px] font-black uppercase text-slate-400 ml-4 italic">Elegir D√≠a</label>
                <input type="date" id="fecha" class="input-modern" required>
            </div>

            <div class="space-y-1">
                <label class="text-[10px] font-black uppercase text-slate-400 ml-4 italic">Elegir Hora</label>
                <input type="time" id="hora" class="input-modern" required>
            </div>

            <button type="submit" id="btn-submit" class="w-full py-6 bg-slate-900 text-white rounded-[2.5rem] font-black uppercase text-[10px] tracking-[0.2em] shadow-2xl transition-all duration-500 hover:scale-105 active:scale-95">Confirmar Reservaci√≥n</button>
        </form>

        <footer class="mt-10 text-center border-t border-slate-100 pt-8">
            <button onclick="document.getElementById('modal-privacidad').classList.remove('hidden')" class="text-[10px] font-black text-slate-300 underline uppercase tracking-tighter hover:text-slate-500 transition">Aviso de Privacidad Legal</button>
        </footer>
    </div>

    <div id="modal-privacidad" class="hidden fixed inset-0 bg-slate-900/90 backdrop-blur-xl flex items-center justify-center p-6 z-50">
        <div class="bg-white p-10 rounded-[3.5rem] max-w-sm w-full shadow-2xl border-b-[12px]" id="modal-border">
            <h2 class="text-2xl font-black mb-4 uppercase italic tracking-tighter" id="priv-titulo">Privacidad</h2>
            <p class="text-xs text-slate-500 leading-relaxed mb-8 italic" id="priv-texto"></p>
            <button onclick="document.getElementById('modal-privacidad').classList.add('hidden')" class="w-full py-4 bg-slate-900 text-white rounded-2xl font-black text-[10px] uppercase tracking-widest">Entendido</button>
        </div>
    </div>

    <script>
        const URL_DB = "https://dgatsbnqgplalxwewpvs.supabase.co"; 
        const KEY_DB = "sb_publishable_qXj4L3x_s2sP3-FFQpIOhA_GXP0qX8i"; 
        const docId = new URLSearchParams(window.location.search).get('id');

        const CATALOGO = {
            "Ginecolog√≠a": [
                { color: "#f43f5e", icon: "üå∏", bg: "üå∏", priv: "Tus datos de salud femenina son tratados con la m√°xima delicadeza y confidencialidad absoluta." },
                { color: "#8b5cf6", icon: "üîÆ", bg: "‚ú®", priv: "Sofisticaci√≥n y calma. Resguardamos tu informaci√≥n con la elegancia que mereces." },
                { color: "#fb7185", icon: "üå∑", bg: "üéÄ", priv: "Suavidad y atenci√≥n profesional. Cuidamos de ti y de tu bienestar con reserva." },
                { color: "#059669", icon: "üçÉ", bg: "üåø", priv: "Salud org√°nica. Tu privacidad es un proceso natural y seguro con nosotros." },
                { color: "#1e293b", icon: "üíé", bg: "üõ°Ô∏è", priv: "Discreci√≥n de alta gama. Protocolos de √©lite para el manejo de tu historial cl√≠nico." }
            ],
            "Odontolog√≠a": [
                { color: "#0ea5e9", icon: "üíé", bg: "ü¶∑", priv: "Limpieza y tecnolog√≠a. Registros dentales protegidos bajo seguridad digital extrema." },
                { color: "#10b981", icon: "üåø", bg: "üçÉ", priv: "Frescura y salud. Tu historial dental est√° resguardado en un entorno √©tico." },
                { color: "#22d3ee", icon: "‚ùÑÔ∏è", bg: "‚ú®", priv: "Est√©tica y blanqueamiento. Protegemos tu diagn√≥stico con tecnolog√≠a de vanguardia." },
                { color: "#1e3a8a", icon: "üõ°Ô∏è", bg: "ü¶æ", priv: "Cirug√≠a e implantes. M√°xima seguridad para tus procedimientos especializados." },
                { color: "#6366f1", icon: "‚ö°", bg: "üß¨", priv: "Innovaci√≥n 3D. Diagn√≥sticos digitales protegidos por encriptaci√≥n m√©dica." }
            ],
            "Pediatr√≠a": [
                { color: "#fb923c", icon: "üß∏", bg: "üéà", priv: "Entorno alegre. La privacidad de los ni√±os es sagrada y est√° totalmente protegida." },
                { color: "#38bdf8", icon: "üöÄ", bg: "‚òÅÔ∏è", priv: "Confianza y juego. Solo tutores autorizados acceden al historial del menor." },
                { color: "#4ade80", icon: "ü¶ñ", bg: "üå≥", priv: "Aventura segura. Datos pedi√°tricos resguardados con absoluta √©tica y reserva." },
                { color: "#f472b6", icon: "üç≠", bg: "‚ú®", priv: "Dulce cuidado. Tratamos la informaci√≥n infantil con ternura y seguridad total." },
                { color: "#818cf8", icon: "üåô", bg: "‚≠ê", priv: "Estrella de calma. Un entorno sereno para la privacidad de los m√°s peque√±os." }
            ],
            "Cardiolog√≠a": [
                { color: "#e11d48", icon: "‚ù§Ô∏è", bg: "üìà", priv: "Precisi√≥n card√≠aca. Encriptaci√≥n de grado m√©dico para tus datos vitales." },
                { color: "#1e293b", icon: "‚ö°", bg: "üß¨", priv: "Seriedad y vanguardia. Monitoreo cardiovascular bajo est√°ndares de alta seguridad." },
                { color: "#0284c7", icon: "üåä", bg: "‚ùÑÔ∏è", priv: "Flujo y salud. Tus datos circulatorios est√°n protegidos por tecnolog√≠a Pro." },
                { color: "#9f1239", icon: "ü©∏", bg: "üíâ", priv: "Hematolog√≠a especializada. Resguardo √©tico de tus an√°lisis y datos sangu√≠neos." },
                { color: "#4f46e5", icon: "üõ∞Ô∏è", bg: "üì°", priv: "Ciber Cardiolog√≠a. Seguridad satelital aplicada a tu monitoreo en tiempo real." }
            ],
            "Bienestar (Nutri/Psico)": [
                { color: "#059669", icon: "üßò‚Äç‚ôÇÔ∏è", bg: "üçÉ", priv: "Equilibrio y paz. Tus notas de consulta son privadas y encriptadas √©ticamente." },
                { color: "#a855f7", icon: "üß†", bg: "‚ú®", priv: "Crecimiento seguro. Tu historia emocional es confidencial y est√° protegida." },
                { color: "#fbbf24", icon: "üçé", bg: "‚òÄÔ∏è", priv: "Nutrici√≥n energ√©tica. Planes alimenticios resguardados en nuestra nube privada." },
                { color: "#0ea5e9", icon: "üåä", bg: "üíß", priv: "Inmersi√≥n emocional. Confidencialidad absoluta para tu proceso de sanaci√≥n." },
                { color: "#10b981", icon: "ü•ë", bg: "ü•ó", priv: "Vida fit. Privacidad integral para tu estilo de vida saludable y seguro." }
            ],
            "General": [
                { color: "#1e3a8a", icon: "‚öñÔ∏è", bg: "üõ°Ô∏è", priv: "Autoridad m√©dica. Datos personales y notas encriptadas bajo la ley vigente." },
                { color: "#6366f1", icon: "üè•", bg: "üß¨", priv: "Innovaci√≥n moderna. Seguridad digital de √∫ltima generaci√≥n para tu historial." },
                { color: "#10b981", icon: "ü©∫", bg: "üè•", priv: "Salud b√°sica. Atenci√≥n primaria con seguridad avanzada para tus datos." },
                { color: "#be123c", icon: "üöë", bg: "üö®", priv: "Urgencias. Seguridad inmediata para datos cr√≠ticos en situaciones de emergencia." },
                { color: "#4338ca", icon: "üè¢", bg: "üè¨", priv: "Hospitalario. Protecci√≥n de datos a escala corporativa para redes de salud." }
            ]
        };

        async function init() {
            if(!docId) return alert("Falta Nodo.");
            const res = await fetch(`${URL_DB}/rest/v1/Perfiles_Medicos?id=eq.${docId}`, { headers: { 'apikey': KEY_DB, 'Authorization': `Bearer ${KEY_DB}` } });
            const data = await res.json();
            
            if(data.length > 0) {
                const doc = data[0];
                const cat = CATALOGO[doc.especialidad] || CATALOGO["General"];
                // El truco est√° aqu√≠: buscar el estilo que us√≥ el doctor basado en el template_id o el color
                const t = cat[doc.template_id - 1] || cat[0];

                document.getElementById('doc-name').innerText = "Dr. " + doc.nombre_doctor;
                document.getElementById('doc-esp').innerText = doc.especialidad;
                document.getElementById('icon-header').innerText = t.icon;
                document.documentElement.style.setProperty('--main', t.color);
                
                // Aplicar Look M√≥vil Pro
                document.getElementById('btn-submit').style.backgroundColor = t.color;
                document.getElementById('card-main').style.borderColor = t.color;
                document.getElementById('modal-border').style.borderColor = t.color;
                document.getElementById('visual-1').innerText = t.bg;
                document.getElementById('visual-2').innerText = t.icon;
                document.getElementById('priv-texto').innerText = "AVISO LEGAL: " + t.priv;
                document.getElementById('priv-titulo').style.color = t.color;
            }
        }

        document.getElementById('form-cita').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-submit');
            btn.innerText = "Sincronizando..."; btn.disabled = true;
            const res = await fetch(`${URL_DB}/rest/v1/Citas`, {
                method: 'POST',
                headers: { 'apikey': KEY_DB, 'Authorization': `Bearer ${KEY_DB}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    doctor_id: docId,
                    nombre_paciente: document.getElementById('nombre').value,
                    fecha: document.getElementById('fecha').value,
                    hora: document.getElementById('hora').value,
                    pagado: false
                })
            });
            if(res.ok) { alert("¬°Cita Solicitada!"); location.reload(); }
            else { alert("Error"); btn.disabled = false; }
        });

        init();
    </script>
</body>
</html>
