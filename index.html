<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K.B SYSTEM | ACCESO TOTAL ‚ú¶</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;400;600;800&display=swap');
        
        :root { 
            --kb-gold: #c5a059; 
            --kb-dark: #0f172a; 
            --kb-accent: #6366f1;
        }
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: #020617; 
            color: white; 
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        /* üåå Fondo Espacial de B√∫nker */
        .bunker-bg {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 50% 50%, #1e1b4b 0%, #020617 100%);
            z-index: -1;
        }

        .glow {
            position: absolute;
            width: 500px;
            height: 500px;
            background: var(--kb-gold);
            filter: blur(150px);
            opacity: 0.1;
            border-radius: 50%;
            animation: pulse 8s infinite alternate;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.05; }
            100% { transform: scale(1.3); opacity: 0.15; }
        }

        /* üíé Est√©tica Glassmorphism K.B Tech */
        .glass { 
            background: rgba(15, 23, 42, 0.6); 
            backdrop-filter: blur(40px); 
            border: 1px solid rgba(197, 160, 89, 0.2); 
            border-radius: 4rem; 
            box-shadow: 0 50px 100px -20px rgba(0, 0, 0, 0.8);
        }

        .input-kb { 
            width: 100%; 
            padding: 1.25rem; 
            border-radius: 1.8rem; 
            background: rgba(255,255,255,0.03); 
            border: 1px solid rgba(255,255,255,0.1); 
            color: white; 
            font-weight: 600; 
            transition: 0.4s cubic-bezier(0.23, 1, 0.32, 1); 
        }

        .input-kb:focus { 
            border-color: var(--kb-gold); 
            background: rgba(255,255,255,0.07); 
            outline: none; 
            box-shadow: 0 0 30px rgba(197, 160, 89, 0.2);
            transform: translateY(-2px);
        }

        .btn-access { 
            background: var(--kb-gold); 
            color: var(--kb-dark);
            transition: 0.5s cubic-bezier(0.23, 1, 0.32, 1); 
            font-weight: 900; 
            letter-spacing: 0.2em; 
            position: relative;
            overflow: hidden;
            border-radius: 1.8rem;
        }

        .btn-access:hover:not(:disabled) { 
            transform: translateY(-3px); 
            box-shadow: 0 20px 40px -10px rgba(197, 160, 89, 0.5); 
            filter: brightness(1.1);
        }

        /* ‚ú® ESTRELLA DE MANDO K.B */
        @keyframes star-spin {
            0% { transform: rotate(0deg) scale(1); opacity: 0.7; }
            50% { transform: rotate(180deg) scale(1.2); opacity: 1; }
            100% { transform: rotate(360deg) scale(1); opacity: 0.7; }
        }
        .kb-star { 
            color: var(--kb-gold); 
            display: inline-block;
            animation: star-spin 4s infinite linear;
            font-size: 2.5rem;
        }

        .scan-line {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 2px;
            background: linear-gradient(90deg, transparent, var(--kb-gold), transparent);
            animation: scan 4s linear infinite;
            opacity: 0.2;
        }

        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }
    </style>
</head>
<body>

    <div class="bunker-bg"></div>
    <div class="glow"></div>

    <div class="max-w-md w-full glass p-12 md:p-16 relative overflow-hidden">
        <div class="scan-line"></div>
        
        <header class="mb-12 text-center">
            <div class="mb-6">
                <span class="kb-star">‚ú¶</span>
            </div>
            <h1 class="text-5xl font-black italic tracking-tighter uppercase leading-none text-white">
                K.B <span style="color: var(--kb-gold)">SYSTEM</span>
            </h1>
            <div class="flex items-center justify-center gap-3 mt-6">
                <div class="h-[1px] w-10 bg-slate-800"></div>
                <p class="text-[9px] font-black text-[#c5a059] uppercase tracking-[0.5em] italic">Auth Protocol v4.0</p>
                <div class="h-[1px] w-10 bg-slate-800"></div>
            </div>
        </header>

        <form id="loginForm" class="space-y-6">
            <div class="group">
                <label class="text-[8px] font-black uppercase tracking-widest text-slate-500 ml-4 mb-2 block">Identificador de Operaciones</label>
                <input type="email" id="email" class="input-kb uppercase text-xs" placeholder="CORREO@KBTECH.PRO" required>
            </div>
            <div>
                <label class="text-[8px] font-black uppercase tracking-widest text-slate-500 ml-4 mb-2 block">C√≥digo de Encriptaci√≥n</label>
                <input type="password" id="password" class="input-kb" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
            </div>
            
            <button type="submit" id="btnLogin" class="w-full btn-access p-6 text-[11px] uppercase mt-4 shadow-2xl">
                Sincronizar ADN üöÄ
            </button>
        </form>

        <div id="error-msg" class="hidden mt-8 p-4 bg-rose-500/10 border border-rose-500/20 rounded-2xl text-center">
            <p class="text-[9px] font-black text-rose-500 uppercase tracking-widest italic">‚ö†Ô∏è Acceso Denegado: Registro No Encontrado</p>
        </div>
        
        <footer class="mt-16 text-center">
            <p class="text-[7px] font-bold uppercase tracking-[0.6em] text-slate-600 italic leading-loose">
                TIJUANA INFRASTRUCTURE / K.B TECH SOLUTIONS ‚ú¶ 2026
            </p>
        </footer>
    </div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const supabase = createClient('https://ctvqjnckxmqeejbfwmkj.supabase.co', 'sb_publishable__JScNe1oUvVbV4Vww69CLg_6EasQg3w');

document.getElementById('loginForm').onsubmit = async (e) => {
    e.preventDefault();
    const emailVal = document.getElementById('email').value;
    const passVal = document.getElementById('password').value;
    const btn = document.getElementById('btnLogin');
    const msg = document.getElementById('error-msg');

    btn.innerText = "VERIFICANDO ADN...";
    btn.disabled = true;
    msg.classList.add('hidden');

    try {
        // üîê 1. Verificaci√≥n de Credenciales en Auth
        const { data, error } = await supabase.auth.signInWithPassword({
            email: emailVal,
            password: passVal
        });

        if (error) throw error;

        // üß¨ 2. Recuperaci√≥n de Perfil de B√∫nker
        const { data: usuario, error: userError } = await supabase
            .from('Usuarios')
            .select('*')
            .eq('id', data.user.id)
            .single();

        if (userError || !usuario) throw new Error("Nodo no reconocido");

        // üß† 3. Memoria Local Temporal
        localStorage.setItem('user_id', data.user.id);
        localStorage.setItem('rol', usuario.rol);
        localStorage.setItem('nombre', usuario.nombre);

        btn.innerText = "ACCESO CONCEDIDO ‚ú¶";
        btn.style.background = "#10b981";
        btn.style.color = "white";

        // üõ∞Ô∏è 4. Redirecci√≥n por Rango
        setTimeout(() => {
            if (usuario.rol === 'doctor') {
                window.location.href = 'nodo-maestro.html';
            } else if (usuario.rol === 'asistente') {
                window.location.href = 'asistente.html';
            } else {
                alert("Rango Administrativo no configurado");
                btn.disabled = false;
            }
        }, 1000);

    } catch (err) {
        console.error(err);
        btn.innerText = "REINTENTAR";
        btn.disabled = false;
        msg.classList.remove('hidden');
    }
};
</script>
</body>
</html>
